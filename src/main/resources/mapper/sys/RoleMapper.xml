<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yeqifu.sys.mapper.RoleMapper">

    <!--查询角色-->
    <select id="queryAllRole" resultType="com.yeqifu.sys.domain.Role">
        select
        roleid, rolename, roledesc, available
        from sys_role
        <where>
            <if test="req.rolename!=null and req.rolename!=''">
                and rolename like concat("%",#{req.rolename},"%")
            </if>
            <if test="req.roledesc!=null and req.roledesc!=''">
                and roledesc like concat("%",#{req.roledesc},"%")
            </if>
            <if test="req.available!=null">
                and available=#{req.available}
            </if>
        </where>
    </select>

    <!--添加角色-->
    <insert id="addRole" parameterType="com.yeqifu.sys.req.AddOrUpdateRoleReq">
        INSERT INTO sys_role (rolename, roledesc, available)
        VALUES (#{req.rolename}, #{req.roledesc}, #{req.available})
    </insert>

    <!--更新角色-->
    <update id="updateRole" parameterType="com.yeqifu.sys.req.AddOrUpdateRoleReq">
        UPDATE sys_role
        SET rolename = #{req.rolename},
            roledesc  = #{req.roledesc},
            available  = #{req.available}
        WHERE roleid = #{req.roleid}
    </update>

    <!--保存角色和菜单之间的关系-->
    <insert id="insertRoleMenu">
      insert into sys_role_menu(rid, mid) values(#{rid},#{mid})
    </insert>

    <!--根据角色id删除sys_role_menu里面的数据 deleteRoleMenuByRid-->
    <delete id="deleteRoleMenuByRid">
        delete from sys_role_menu where rid=#{roleid}
    </delete>

    <!--根据用户id查询角色列表-->
    <select id="queryRoleByUid" resultType="com.yeqifu.sys.domain.Role">
      select t1.* from sys_role t1 inner join sys_role_user t2 on(t1.roleid=t2.rid) where t2.uid=#{uid}
    </select>

</mapper>